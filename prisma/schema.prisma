generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model level {
  id    Int     @id
  level String  @db.VarChar(30)
  users user[]
}

model user {
  id             Int             @id @default(autoincrement())
  level_id       Int
  nama           String?         @db.VarChar(50)
  telp           String?         @db.Char(15)
  alamat         String?         @db.Text
  email          String?         @db.VarChar(100)
  username       String          @unique @db.VarChar(50)
  password       String          @db.VarChar(225)
  mfa_enabled    Boolean         @default(false)
  mfa_secret     String?         @db.VarChar(100)
  valid          Boolean         @default(false)
  login          Boolean         @default(false)
  foto           String?         @db.Text
  last_access    DateTime?       @db.Timestamp(0)
  created_at     DateTime?       @default(now()) @db.Timestamp(0)
  updated_at     DateTime?       @db.Timestamp(0)
  deleted_at     DateTime?       @db.Timestamp(0)
  level          level           @relation(fields: [level_id], references: [id], onUpdate: NoAction, map: "admin_ibfk_1")
  armada_surveys armada_survey[]

  @@index([level_id], map: "level_id")
}

model service_type {
  id                   Int                   @id @default(autoincrement())
  name                 String                @unique
  armada_question_sets armada_question_set[]
  armadaSurveys        armada_survey[]

  @@map("service_type")
}

model fleet_type {
  id                   Int                   @id @default(autoincrement())
  name                 String                @unique
  armada_question_sets armada_question_set[]
  armadaSurveys        armada_survey[]

  @@map("fleet_type")
}

model armada_question_set {
  id            Int               @id @default(autoincrement())
  description   String?
  questions     armada_question[]
  service_types service_type[]
  fleet_types   fleet_type[]

  @@map("armada_question_set")
}

model armada_question {
  id             Int                    @id @default(autoincrement())
  set_id         Int
  section        section_armada         @default(KEAMANAN)
  basic          String?                @db.Text
  indicator      String?                @db.Text
  spm_criteria   String                 @db.Text
  spm_reference  String?
  order          String?                @default("a")
  question_set   armada_question_set    @relation(fields: [set_id], references: [id], onDelete: Cascade)
  survey_answers armada_survey_answer[]

  @@map("armada_question")
}

model armada_survey {
  id              Int                    @id @default(autoincrement())
  surveyor_id     Int
  service_type_id Int
  fleet_type_id   Int
  tanggal         DateTime
  periode         String
  jam_mulai       String
  jam_selesai     String
  no_body         String
  kode_trayek     String
  asal_tujuan     String
  finish          Boolean                @default(false)
  created_at      DateTime               @default(now())
  service_type    service_type           @relation(fields: [service_type_id], references: [id])
  fleet_type      fleet_type             @relation(fields: [fleet_type_id], references: [id])
  surveyor        user                  @relation(fields: [surveyor_id], references: [id])
  answers         armada_survey_answer[]

  @@map("armada_survey")
}

model armada_survey_answer {
  id               Int             @id @default(autoincrement())
  armada_survey_id Int
  question_id      Int
  answer           Boolean
  note             String?
  photo_url        String?
  armada_survey    armada_survey   @relation(fields: [armada_survey_id], references: [id], onDelete: Cascade)
  question         armada_question @relation(fields: [question_id], references: [id])

  @@unique([armada_survey_id, question_id])
  @@map("armada_survey_answer")
}


enum section_armada {
  KEAMANAN
  KESELAMATAN
  KENYAMANAN
  KESETARAAN
  KETERATURAN
}